#!/usr/bin/env zsh

runemacs=`which emacs`

eval_prefix='--eval "('
runfunc=""
title='-T '

# $opt will hold the current option
local opt
while getopts cemft: opt; do
    # loop continues till options finished
    # see which pattern $opt matches...
    case $opt in
        (c)
            runemacs=`which emacsclient`' -c'
            ;;
        (e)
            runfunc=$eval_prefix'mu4e)"'
            title=$title"Email"
            ;;
        (m)
            runfunc=$eval_prefix'main-window)"'
            title=$title$OPTARG
            ;;
        (f)
            runfunc=$eval_prefix$OPTARG')"'
            ;;
        (t)
            title=$title$OPTARG
            ;;
	# matches a question mark
	# (and nothing else, see text)
        (\?)
            print Bad option, aborting.
            return 1
            ;;
    esac
done
(( OPTIND > 1 )) && shift $(( OPTIND - 1 ))
##print Remaining arguments are: $*

mycommand=$runemacs' '${title}' '${*}' '$runfunc' &'

print "Emacs With Command:" $mycommand

eval $mycommand
